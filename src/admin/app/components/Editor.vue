<template>
  <Monaco :value="raw" :language="language" @change="update" />
</template>

<script setup lang="ts">
import type { PropType } from 'vue3'
import { ref, watch, defineProps, computed } from 'vue3'
import type { File } from '../../type'
import { useApi } from '../plugins/api'
import Monaco from './Monaco.vue'

const props = defineProps({
  file: {
    type: Object as PropType<File>,
    required: true
  },
  apiEntry: {
    type: String,
    default: '/content'
  }
})

const api = useApi()
const raw = ref(props.file.raw)

const language = computed(() => {
  if (props.file.extension === '.vue') return 'html'
  if (props.file.extension === '.ts') return 'javascript'
  if (props.file.extension === '.js') return 'javascript'
  return 'markdown'
})

// Sync local data when file changes
watch(
  () => props.file,
  newVal => {
    raw.value = newVal.raw
  }
)

function update(content) {
  api.put(props.apiEntry + props.file.path, {
    raw: content
  })
}
</script>
